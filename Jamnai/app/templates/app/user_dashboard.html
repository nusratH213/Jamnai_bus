{% extends 'app/head.html' %}
{% block title %}User Dashboard{% endblock %}
{% block navbar_heading %}
    User Dashboard
{% endblock %}
{% block content %}
<style>
    .container { 
        background: white; 
        padding: 20px; 
        border-radius: 8px; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        max-width: 1000px; 
        margin: auto; 
    }
    table { 
        width: 100%; 
        border-collapse: collapse; 
        margin-top: 20px; 
    }
    th, td { 
        border: 1px solid #ddd; 
        padding: 12px; 
        text-align: center; 
    }
    th { 
        background-color: #ffeeba; 
    }
    .route-box { 
        margin-top: 20px; 
    }
    .status-log { 
        background: #f8f9fa; 
        padding: 10px; 
        border-radius: 4px; 
        margin-top: 20px; 
    }
    .input-form {
        text-align: center; 
        margin: 20px 0;
    }
    .input-form input {
        padding: 6px; 
        margin: 0 8px; 
    }
    .input-form button {
        padding: 6px 12px; 
        background-color: #ffc107; 
        border: none; 
        border-radius: 4px; 
        cursor: pointer;
    }
    .input-form button:hover {
        background-color: #e0a800;
    }
</style>

<div class="container">
        <form class="input-form" method="POST">
            {% csrf_token %}
            <label for="source">Source:</label>
            <input type="text" id="source" name="source" list="stopage-list" required>

            <label for="destination">Destination:</label>
            <input type="text" id="destination" name="destination" list="stopage-list" required>

            <datalist id="stopage-list"></datalist>

            <button type="submit">Submit</button>
        </form>


    {% if routes_with_path %}
        <div class="route-box">
            <h3>Matching Routes:</h3>
            {% for route_info in routes_with_path %}
                <p><strong>Route ID:</strong> {{ route_info.route.route_id }}</p>
                <p>{{ route_info.stopages|join:" â‡„ " }}</p>
                <hr>
            {% endfor %}
        </div>
    {% elif request.method == "POST" %}
        <p>No route found containing both stopages in order.</p>
    {% endif %}

    <table>
        <thead>
            <tr>
                <th>Bus ID</th>
                <th>Last Stopage</th>
                <th>Last Departure</th>
                <th>Estimated</th>
                <th>Updated At</th>
            </tr>
        </thead>
        <tbody>
            {% for bus in buses_info %}
            <tr>
                <td>{{ bus.bus_id }}</td>
                <td>{{ bus.last_stopage }}</td>
                <td>{{ bus.last_departure }}</td>
                <td>{{ bus.estimated_time }}</td>
                <td>{{ bus.updated_at|date:"h:i A" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="5">No buses found</td></tr>
            {% endfor %}
        </tbody>
    </table>
    <!-- <div class="status-log">
        <h4>Recent Activity Logs</h4>
        <ul>
            <li>[09:03 AM] Manager at Kazipara confirmed arrival</li>
            <li>[08:55 AM] Bus-101 started from Mirpur 10</li>
            <li>[08:40 AM] Bus-103 completed journey at Jatrabari</li>
        </ul>
    </div> -->
</div>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        fetch('/gets/')
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById('stopage-list');
                if (data.destinations) {
                    data.destinations.forEach(stopage => {
                        const option = document.createElement('option');
                        option.value = stopage;
                        list.appendChild(option);
                    });
                }
            })
            .catch(error => console.error('Error loading stopages:', error));
    });
</script>

{% endblock %}